
# Отчёт "Комплексное исследование производительности чёрного ящика"

## 1. Окружение

### ОС

- **ОС:** linux
- **Дистрибутив:** Debian

### Аппаратные ресурсы

- **Кол-во ядер CPU:** 12
- **RAM:** 32 gb

---

## 2. Методика и инструменты тестирования


### Сценарий прогона (как тестировалось)

- Приложение `app_linux_amd64` запускалось без аргументов и работало параллельно с подачей HTTP‑нагрузки генератором vegeta.
- Во время прогона непрерывно собирались системные метрики (очереди выполнения, CPU, память, I/O и т.д) в отдельные лог‑файлы.
- В качестве цели теста рассматривалось поведение приложения под ступенчатой и стрессовой нагрузкой, а также под длительной нагрузкой уровня умеренного уровня.

### Нагрузочный профиль vegeta (targets/rate в целом)

- Нагрузка задавалась в виде фаз с фиксированным rate (rps) и известными временными интервалами.
- Конкретные targets/endpoint’ы vegeta задаются в отдельном файле `targets.txt`

```
GET http://localhost:8080/
User-Agent: vegeta-test
X-Test-Header1: value1
X-Test-Header2: value2

POST http://localhost:8080/
Content-Type: application/json
User-Agent: vegeta-test
X-Test-Header1: value1
X-Test-Header2: value2
@post_body.json
```

---

### Таймлайн нагрузки

Фазы и интенсивность нагрузки vegeta по времени:

| Фаза          | Интервал (MSK)       | Интенсивность |
| ------------- |----------------------|---------------|
| Холодный старт     | 19:04:55–19:06:25    | 0 rps         |
| Прогрев на малом RPS     | 19:06:25–19:08:27    | 20/1s         |
| Шаг 1    | 19:08:27–19:10:01    | 50/1s         |
| Шаг 2    | 19:10:01–19:11:38    | 100/1s        |
| Шаг 3    | 19:11:38–19:13:18    | 150/1s        |
| Шаг 4    | 19:13:18–19:15:02    | 200/1s        |
| "Стресс"-тест на бОльшем RPS  | 19:15:02–19:15:45    | 400/1s        |
| Умеренная нагрузка, стабилизация      | 19:15:45–19:21:19    | 150/1s        |
| Тест сотсояния покоя после отключения нагрузки | 19:21:19–19:25:13    | 0 rps         |

---

### Увязка фаз нагрузки с наблюдаемой деградацией

- Фаза **03_stress_01 (400 rps)** попадает в интервал, после которого в метриках очереди выполнения и числа blocked‑задач фиксируется усиление деградации: растёт `runq-sz`, увеличивается `blocked`, повышается load average.  
- Фаза **04_soak (150 rps)** совпадает по времени с наиболее выраженными симптомами: высокие значения load average, увеличенная очередь выполнения и значимое число задач в D‑state, что согласуется со сценарием I/O‑bound или “шторм ожиданий”.  
- В фазе **cooldown idle (0 rps)** нагрузка со стороны vegeta снимается, но системные метрики могут “сходить” не мгновенно: очереди и blocked сокращаются с инерцией, что важно учитывать при интерпретации восстановления после нагрузки.

---

## Утилиты мониторинга

- sar  
- mpstat  
- pidstat  
- vmstat  
- iostat  
- ps  
- top  

---

## Сводная таблица: лог‑файл → метрики

| Лог-файл                 | Какие метрики отражены                                                                 |
|--------------------------|----------------------------------------------------------------------------------------|
| `sar_q.log`              | Очередь выполнения и планирование: `runq-sz`, `plist-sz`, `ldavg-1/5/15`, `blocked`.  |
| `sar_blockio.log`        | Блочный I/O (агрегировано): `tps`, `rtps`, `wtps`, `breads`, `bwrtn`.                 |
| `mpstat.log`             | Per‑CPU утилизация: нагрузка по ядрам (`%usr`, `%sys`, `%iowait`, `%idle`).          |
| `pidstat_cpu_threads.log`| CPU по процессу и потокам: загрузка CPU каждым потоком процесса.                      |
| `pidstat_ctx_threads.log`| Context switches по потокам: `cswch/s`, `nvcswch/s`.                                  |
| `pidstat_io_proc.log`    | I/O на уровне процесса: чтение/запись в единицу времени.                              |
| `vmstat.log`             | Общесистемно: `r/b`, память, swap (`si/so`), I/O (`bi/bo`), interrupts/context switches. |
| `iostat_xz.log`          | Диски/устройства: throughput, `await`, `avgqu-sz`, `%util`.                           |
| `threads_dump.log`       | Снимки потоков процесса: TID, `STAT`, `PSR`, `%CPU`, `%MEM`, имя потока.             |
| `threads_summary.log`    | Агрегированная сводка по потокам (топ по CPU/ctx, статусы).                          |
| `snapshots_mem.log`      | Снимки состояния памяти (free/available/cache или аналогичные значения).             |
| `timeline.txt`           | Описание фаз и таймлайна теста (этапы нагрузки, времена начала/окончания).           |
| `vegeta_full.sh` | Скрипты запуска vegeta: targets, rate, duration, параметры нагрузки.           |
